!function(){"use strict";const e=["pan","draw","select"],t=(e,t)=>!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+e.width)&&!(t.y>e.y+e.height))),n="http://www.w3.org/2000/svg",r=e=>e&&1===e.nodeType,i=(e,...t)=>{t.forEach(t=>{Object.keys(t).forEach(n=>{const r=String(t[n]);e.setAttribute(n,r)})})},o=(e,t=document)=>{const n=t.querySelector(e);if(null===n)throw Error(`Expected ${e} to match something`);return n},s=e=>{const{x:t,y:n,width:r,height:i}=e;return{x:t.baseVal.value,y:n.baseVal.value,width:r.baseVal.value,height:i.baseVal.value}},d=(e,t)=>{const n=s(e),{x:r,y:i,width:o,height:d}=Object.assign({},n,t);e.x.baseVal.value=r,e.y.baseVal.value=i,e.width.baseVal.value=o,e.height.baseVal.value=d},l=(e,...t)=>{const o=document.createElementNS(n,e);return t.forEach(e=>{var t;r(t=e)&&t.namespaceURI===n||r(e)||"string"==typeof e?o.append(e):i(o,e)}),o},a=e=>(...t)=>l(e,...t),h=a("svg"),c=a("g"),u=a("rect"),p=a("defs"),f=["left","xCenter","right"],m=["top","yCenter","bottom"],y=e=>{const t=[];return m.forEach(n=>{const r=(({y:e,height:t},n)=>{switch(n){case"top":return e;case"bottom":return e+t;case"yCenter":return e+t/2}})(e,n);f.forEach(i=>{if("yCenter"===n&&"xCenter"===i)return;const o=(({x:e,width:t},n)=>{switch(n){case"left":return e;case"right":return e+t;case"xCenter":return e+t/2}})(e,i),s=g({x:o,y:r},i,n);t.push(s)})}),t},g=({x:e,y:t},n,r)=>{switch(e-=4,t-=4,n){case"left":e+=1;case"right":e-=.5}switch(r){case"top":t+=1;case"bottom":t-=.5}const i=u({class:["handle",n,r].join(" "),stroke:"rgba(64, 128, 255, 1)",fill:"rgba( 255, 255, 255, 0.75 )"});return d(i,{x:e,y:t,width:8,height:8}),i};function v(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var b=v((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=e=>Array.isArray(e),r=e=>null===e,i=e=>"object"==typeof e&&!r(e)&&!n(e);t.is={number:e=>"number"==typeof e&&isFinite(e),integer:e=>Number.isInteger(e),string:e=>"string"==typeof e,boolean:e=>"boolean"==typeof e,array:n,null:r,undefined:e=>void 0===e,function:e=>"function"==typeof e,object:i,empty:e=>i(e)&&(e=>{for(const t in e)return!1;return!0})(e)}}));const x=e=>{const t=Object.keys(e),n=(t,n)=>e[n]&&e[n](t),r=e=>t.filter(t=>n(e,t));return{isType:n,isOnly:(e,t)=>n(e,t)&&1===r(e).length,some:(e,...t)=>t.some(t=>n(e,t)),every:(e,...t)=>t.every(t=>n(e,t)),of:e=>t.find(t=>n(e,t)),allOf:r,types:()=>t.slice()}},w=x(b.is);var S={is:b.is,extendDefaults:e=>Object.assign({},e,b.is,e),utils:w,Utils:x},C=Object.freeze({DISCONNECTED:1,PRECEDING:2,FOLLOWING:4,CONTAINS:8,CONTAINED_BY:16});const E=Symbol(),O=Symbol(),N=Symbol(),_=Symbol();class I{constructor(e,t,n,r){this[E]=e,this[O]=t,this[N]=n,this[_]=r}next(){const e=this[E],t=this[_],n=this[O];if(!this[N])return{done:!0,value:n};const r=this[N];return this[N]=1===t?e._node(r).previousSibling:2===t?e._node(r).nextSibling:3===t?e._node(r).parent:4===t?e.preceding(r,{root:n}):e.following(r,{root:n}),{done:!1,value:r}}}Object.defineProperty(I.prototype,Symbol.iterator,{value:function(){return this},writable:!1}),I.PREV=1,I.NEXT=2,I.PARENT=3,I.PRECEDING=4,I.FOLLOWING=5,Object.freeze(I),Object.freeze(I.prototype);var A=I;function T(){return!0}function P(e,t){return e[e.length-1-t]}class j{constructor(e){this.symbol=Symbol(e||"SymbolTree data")}initialize(e){return this._node(e),e}_node(e){if(!e)return null;const t=e[this.symbol];return t||(e[this.symbol]=new class{constructor(){this.parent=null,this.previousSibling=null,this.nextSibling=null,this.firstChild=null,this.lastChild=null,this.childrenVersion=0,this.childIndexCachedUpTo=null,this.cachedIndex=-1,this.cachedIndexVersion=NaN}get isAttached(){return Boolean(this.parent||this.previousSibling||this.nextSibling)}get hasChildren(){return Boolean(this.firstChild)}childrenChanged(){this.childrenVersion=this.childrenVersion+1&4294967295,this.childIndexCachedUpTo=null}getCachedIndex(e){return this.cachedIndexVersion!==e.childrenVersion?(this.cachedIndexVersion=NaN,-1):this.cachedIndex}setCachedIndex(e,t){this.cachedIndexVersion=e.childrenVersion,this.cachedIndex=t}})}hasChildren(e){return this._node(e).hasChildren}firstChild(e){return this._node(e).firstChild}lastChild(e){return this._node(e).lastChild}previousSibling(e){return this._node(e).previousSibling}nextSibling(e){return this._node(e).nextSibling}parent(e){return this._node(e).parent}lastInclusiveDescendant(e){let t,n=e;for(;t=this._node(n).lastChild;)n=t;return n}preceding(e,t){if(e===(t&&t.root))return null;const n=this._node(e).previousSibling;return n?this.lastInclusiveDescendant(n):this._node(e).parent}following(e,t){const n=t&&t.root,r=!(t&&t.skipChildren)&&this._node(e).firstChild;if(r)return r;let i=e;do{if(i===n)return null;const e=this._node(i).nextSibling;if(e)return e;i=this._node(i).parent}while(i);return null}childrenToArray(e,t){const n=t&&t.array||[],r=t&&t.filter||T,i=t&&t.thisArg||void 0,o=this._node(e);let s=o.firstChild,d=0;for(;s;){const e=this._node(s);e.setCachedIndex(o,d),r.call(i,s)&&n.push(s),s=e.nextSibling,++d}return n}ancestorsToArray(e,t){const n=t&&t.array||[],r=t&&t.filter||T,i=t&&t.thisArg||void 0;let o=e;for(;o;)r.call(i,o)&&n.push(o),o=this._node(o).parent;return n}treeToArray(e,t){const n=t&&t.array||[],r=t&&t.filter||T,i=t&&t.thisArg||void 0;let o=e;for(;o;)r.call(i,o)&&n.push(o),o=this.following(o,{root:e});return n}childrenIterator(e,t){const n=t&&t.reverse,r=this._node(e);return new A(this,e,n?r.lastChild:r.firstChild,n?A.PREV:A.NEXT)}previousSiblingsIterator(e){return new A(this,e,this._node(e).previousSibling,A.PREV)}nextSiblingsIterator(e){return new A(this,e,this._node(e).nextSibling,A.NEXT)}ancestorsIterator(e){return new A(this,e,e,A.PARENT)}treeIterator(e,t){const n=t&&t.reverse;return new A(this,e,n?this.lastInclusiveDescendant(e):e,n?A.PRECEDING:A.FOLLOWING)}index(e){const t=this._node(e),n=this._node(t.parent);if(!n)return-1;let r=t.getCachedIndex(n);if(r>=0)return r;r=0;let i=n.firstChild;if(n.childIndexCachedUpTo){const e=this._node(n.childIndexCachedUpTo);i=e.nextSibling,r=e.getCachedIndex(n)+1}for(;i;){const t=this._node(i);if(t.setCachedIndex(n,r),i===e)break;++r,i=t.nextSibling}return n.childIndexCachedUpTo=e,r}childrenCount(e){const t=this._node(e);return t.lastChild?this.index(t.lastChild)+1:0}compareTreePosition(e,t){if(e===t)return 0;const n=[];{let r=e;for(;r;){if(r===t)return C.CONTAINS|C.PRECEDING;n.push(r),r=this.parent(r)}}const r=[];{let n=t;for(;n;){if(n===e)return C.CONTAINED_BY|C.FOLLOWING;r.push(n),n=this.parent(n)}}const i=P(n,0);if(!i||i!==P(r,0))return C.DISCONNECTED;let o=0;const s=Math.min(n.length,r.length);for(let e=0;e<s;++e){if(P(n,e)!==P(r,e))break;o=e}const d=this.index(P(n,o+1));return this.index(P(r,o+1))<d?C.PRECEDING:C.FOLLOWING}remove(e){const t=this._node(e),n=this._node(t.parent),r=this._node(t.previousSibling),i=this._node(t.nextSibling);return n&&(n.firstChild===e&&(n.firstChild=t.nextSibling),n.lastChild===e&&(n.lastChild=t.previousSibling)),r&&(r.nextSibling=t.nextSibling),i&&(i.previousSibling=t.previousSibling),t.parent=null,t.previousSibling=null,t.nextSibling=null,t.cachedIndex=-1,t.cachedIndexVersion=NaN,n&&n.childrenChanged(),e}insertBefore(e,t){const n=this._node(e),r=this._node(n.previousSibling),i=this._node(t),o=this._node(n.parent);if(i.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return i.parent=n.parent,i.previousSibling=n.previousSibling,i.nextSibling=e,n.previousSibling=t,r&&(r.nextSibling=t),o&&o.firstChild===e&&(o.firstChild=t),o&&o.childrenChanged(),t}insertAfter(e,t){const n=this._node(e),r=this._node(n.nextSibling),i=this._node(t),o=this._node(n.parent);if(i.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return i.parent=n.parent,i.previousSibling=e,i.nextSibling=n.nextSibling,n.nextSibling=t,r&&(r.previousSibling=t),o&&o.lastChild===e&&(o.lastChild=t),o&&o.childrenChanged(),t}prependChild(e,t){const n=this._node(e),r=this._node(t);if(r.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return n.hasChildren?this.insertBefore(n.firstChild,t):(r.parent=e,n.firstChild=t,n.lastChild=t,n.childrenChanged()),t}appendChild(e,t){const n=this._node(e),r=this._node(t);if(r.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return n.hasChildren?this.insertAfter(n.lastChild,t):(r.parent=e,n.firstChild=t,n.lastChild=t,n.childrenChanged()),t}}var M=j;j.TreePosition=C;var k=v((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.valueSymbol=Symbol("Mojule node value"),t.apiSymbol=Symbol("Mojule node API");const n=new M("Mojule node"),r=e=>e[t.apiSymbol];t.isTreeNode=e=>e&&e[t.valueSymbol],t.createNode=(e,i={})=>{const{extend:o}=i,s={value:e};n.initialize(s);const d=e=>{if(n.parent(e[t.valueSymbol])!==s)throw Error("Not a child of this node")},l={get value(){return s.value},set value(e){s.value=e},get firstChild(){return n.hasChildren(s)?n.firstChild(s)[t.apiSymbol]:null},get lastChild(){return n.hasChildren(s)?n.lastChild(s)[t.apiSymbol]:null},get previousSibling(){const e=n.previousSibling(s);return e?e[t.apiSymbol]:null},get nextSibling(){const e=n.nextSibling(s);return e?e[t.apiSymbol]:null},get parentNode(){const e=n.parent(s);return e?e[t.apiSymbol]:null},get childNodes(){return n.childrenToArray(s).map(r)},get ancestorNodes(){return n.ancestorsToArray(s).map(r)},get index(){return n.index(s)},hasChildNodes:()=>n.hasChildren(s),remove:()=>r(n.remove(s)),removeChild:e=>(d(e),r(n.remove(e[t.valueSymbol]))),insertBefore:(e,i)=>(d(i),n.remove(e[t.valueSymbol]),r(n.insertBefore(i[t.valueSymbol],e[t.valueSymbol]))),insertAfter:(e,i)=>(d(i),n.remove(e[t.valueSymbol]),r(n.insertAfter(i[t.valueSymbol],e[t.valueSymbol]))),prependChild:e=>(n.remove(e[t.valueSymbol]),r(n.prependChild(s,e[t.valueSymbol]))),appendChild:e=>(n.remove(e[t.valueSymbol]),r(n.appendChild(s,e[t.valueSymbol])))};return l[t.valueSymbol]=s,s[t.apiSymbol]=l,S.is.function(o)&&o(l,s,n,t.valueSymbol,t.apiSymbol),l}}));const R=()=>String.fromCharCode(L(26)+97),L=e=>Math.floor(Math.random()*e),z=(e,t)=>Array.from({length:e},(e,n)=>t(n)),D=(e,t)=>{const n=e.get(t);if(void 0===n)throw Error("Expected key "+t);return n},V=(e,t)=>{const{nextIndex:n}=e;e.list=[...e.list.slice(0,n),t],e.nextIndex=e.list.length},B=e=>{const{list:t}=e;if(0===t.length||0===e.nextIndex)return;const n=t[e.nextIndex-1];return e.nextIndex--,n},F=e=>{const{list:t,nextIndex:n}=e;if(0===t.length||n>=t.length)return;const r=t[e.nextIndex];return e.nextIndex++,r},G=()=>{const e=[];let t=[];const n=t=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)};return{on:t=>(e.push(t),{dispose:()=>n(t)}),once:e=>{t.push(e)},off:n,emit:n=>{if(e.forEach(e=>e(n)),t.length>0){const e=t;t=[],e.forEach(e=>e(n))}}}},U=(e,t)=>({addOne:n=>{((e,t)=>{if(e.has(t))throw Error("Duplicate key "+t)})(e,n.id);const r=k.createNode(n);return t.appendChild(r),e.set(n.id,r),n},removeOne:t=>{const n=D(e,t);return n.remove(),e.delete(t),n.value},updateOne:t=>{const n=D(e,t.id),r=n.value;return n.value=t,{prev:r,value:t}},setOrder:n=>{const r=t.childNodes.map(e=>e.value.id);if(n.length!==r.length)throw Error(`Expected ${r.length} ids`);return n.forEach(n=>{const r=D(e,n);t.appendChild(r)}),{type:"order",before:r,after:n}}}),q=(e,t)=>t.sort((t,n)=>{const r=D(e,t),i=D(e,n);return r.index-i.index}),W=()=>{const e=k.createNode({id:"root"}),t=new Map,n=(()=>{const e={list:[],nextIndex:0};return{add:t=>V(e,t),nextUndo:()=>B(e),nextRedo:()=>F(e)}})(),r={add:G(),remove:G(),update:G(),setOrder:G(),undo:G(),redo:G()},i={add:r.add.on,remove:r.remove.on,update:r.update.on,setOrder:r.setOrder.on,undo:r.undo.on,redo:r.redo.on},o=U(t,e),s=((e,t)=>({toStart:n=>{q(e,n).reverse().forEach(n=>{const r=D(e,n);t.prependChild(r)})},toEnd:n=>{q(e,n).forEach(n=>{const r=D(e,n);t.appendChild(r)})},forward:n=>{q(e,n).forEach(n=>{const r=D(e,n);r.nextSibling&&t.insertAfter(r,r.nextSibling)})},back:n=>{q(e,n).reverse().forEach(n=>{const r=D(e,n);r.previousSibling&&t.insertBefore(r,r.previousSibling)})}}))(t,e);return{root:e,elMap:t,commands:n,events:r,on:i,tasks:o,orderActions:s,reorder:$(r,n,e)}},$=(e,t,n)=>r=>i=>{const o=n.childNodes.map(e=>e.value.id);r(i);const s=n.childNodes.map(e=>e.value.id);t.add({type:"order",before:o,after:s}),e.setOrder.emit(s)},X=(e,t)=>Math.floor(e/t)*t,Y=({x:e,y:t},{x:n,y:r})=>({x:e+n,y:t+r}),J=({x:e,y:t},n)=>({x:e*n,y:t*n}),H=({x:e,y:t},{x:n,y:r,scale:i})=>(e-=n,t-=r,{x:e/=i,y:t/=i}),Z=(e,{scale:t,x:n,y:r},i)=>{t<i&&(t=i);const o=((e,t,n)=>{const{scale:r}=e;let i=Y(e,J(n,-1));i=J(i,t/r),i=Y(i,n);return Object.assign(i,{scale:t})})(e,t,{x:n,y:r});return Object.assign({},e,o)};var K=v((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fit=(e,t,n="fill")=>{if("scale-down"===n&&(n=t.width<=e.width&&t.height<=e.height?"none":"contain"),"cover"===n||"contain"===n){const r=e.width/t.width,i=e.height/t.height,o="cover"===n?Math.max(r,i):Math.min(r,i);return{width:t.width*o,height:t.height*o}}return"none"===n?t:e},t.position=(e,t,r="50%",i="50%")=>({x:n(r,e.width,t.width),y:n(i,e.height,t.height)}),t.fitAndPosition=(e,n,r="fill",i="50%",o="50%")=>{const s=t.fit(e,n,r),{x:d,y:l}=t.position(e,s,i,o),{width:a,height:h}=s;return{x:d,y:l,width:a,height:h}};const n=(e,t,n)=>e.endsWith("%")?(t-n)*(parseFloat(e)/100):parseFloat(e)})),Q=v((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.transformFittedPoint=(e,t,n,r="fill",i="50%",o="50%")=>{const{x:s,y:d,width:l,height:a}=K.fitAndPosition(t,n,r,i,o),h=n.width/l,c=n.height/a;return{x:(e.x-s)*h,y:(e.y-d)*c}}})),ee=v((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n={contain:!0,cover:!0,fill:!0,none:!0,"scale-down":!0};t.isFit=e=>e in n})),te=v((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fit=K.fit,t.position=K.position,t.fitAndPosition=K.fitAndPosition,t.transformFittedPoint=Q.transformFittedPoint,t.isFit=ee.isFit}));const ne=()=>{const e=new Set,t=G(),n={add:n=>{n.forEach(t=>e.add(t)),t.emit([...e])},remove:n=>{n.forEach(t=>e.delete(t)),t.emit([...e])},toggle:n=>{n.forEach(t=>{e.has(t)?e.delete(t):e.add(t)}),t.emit([...e])},clear:()=>{e.clear(),t.emit([])},get:()=>{return t=[...e],JSON.parse(JSON.stringify(t));var t},set:t=>{e.clear(),n.add(t)},any:()=>e.size>0},{on:r}=t;return{actions:n,on:r}},re=e=>u(e,{fill:"rgba( 0, 0, 0, 0.5 )"}),ie=e=>()=>{const t=((e,t)=>{const{x:n,y:r,width:i}=te.fitAndPosition(e,t,"contain","50%","50%"),o=i/t.width;return{x:n/o,y:r/o,scale:o}})(e.viewSize(),e.documentSize());e.viewTransform(t)},oe=e=>t=>{const n=e.viewTransform();e.viewTransform(Z(n,t,.1))},se=()=>{const e=o("#body"),t=o("#rects");return n=>{const r=document.querySelector("#resizer");if(r&&r.remove(),0===n.length)return;const i=(e=>{if(0===e.length)return;const[t,...n]=e;let{x:r,y:i}=t,o=r+t.width,s=i+t.height;n.forEach(e=>{const{x:t,y:n,width:d,height:l}=e,a=t+d,h=n+l;t<r&&(r=t),n<i&&(i=n),a>o&&(o=a),h>s&&(s=h)});return{x:r,y:i,width:o-r,height:s-i}})(n.map(e=>o("#"+e,t)).map(s));if(void 0===i)return;const l=(e=>{const t=u({id:"outline",stroke:"rgba(64, 128, 255, 1)",fill:"none"}),n=(({x:e,y:t,width:n,height:r},i=1)=>({x:e+=i/2,y:t+=i/2,width:n-=i,height:r-=i}))(e);d(t,n);return c({id:"resizer"},t,...y(e))})(i);e.append(l)}},de=e=>(...t)=>((e,...t)=>{const n=document.createElement(e);return t.forEach(e=>{var t;(t=e)&&"number"==typeof t.nodeType||"string"==typeof e?n.append(e):i(n,e)}),n})(e,...t),le=de("div"),ae=de("fieldset"),he=de("legend"),ce=de("label"),ue=de("input"),pe=de("button"),fe=de("form"),me=de("header"),ye=de("footer"),ge=de("main"),ve=de("section"),be=({x1:e,y1:t,x2:n,y2:r})=>({x:n-e,y:r-t}),xe=({x:e,y:t},{x:n,y:r})=>({x1:e,y1:t,x2:n,y2:r}),we=(e,t)=>{const{clientX:n,clientY:r}=e;return{x:n-t.left,y:r-t.top}},Se=e=>t=>H(t,e.viewTransform()),Ce=e=>t=>(({x:e,y:t},{width:n,height:r})=>({x:e=X(e,n),y:t=X(t,r)}))(H(t,e.viewTransform()),e.snap()),Ee=e=>e.getBBox(),Oe=()=>[...o("#rects").querySelectorAll("rect")],Ne=(e,n)=>{const r=o("#viewport"),i=o("#rects");return d=>{const l=r.getBoundingClientRect(),a=n(we(d,l));if(e.selection.any()){if(e.selection.get().map(e=>s(o("#"+e,i))).some(e=>t(e,a)))return"move"}return"select"}},_e=(e,t)=>{const n=o("#viewport");let r,i,s;n.addEventListener("mousedown",t=>{const o=n.getBoundingClientRect();s=t.button,r=Date.now(),i=e(we(t,o))}),n.addEventListener("mouseup",o=>{const d=n.getBoundingClientRect();if(Date.now()-r>300)return;const l=e(we(o,d)),a=xe(i,l);Math.abs((e=>{const{x:t,y:n}=be(e);return Math.sqrt(t*t+n*n)})(a))>10||t(s,l)})},Ie=(e,t,{onStart:n=(()=>{}),onEnd:r=(()=>{}),transformPoint:i=Se(e),predicate:s=(()=>!0)}={})=>{const d=o("#viewport");let l=null,a=null,h=null;d.addEventListener("mousedown",e=>{if(!s(e,"start"))return;const t=d.getBoundingClientRect();l=h=a=i(we(e,t)),n(l,h,a)}),d.addEventListener("mousemove",e=>{if(!s(e,"drag"))return;if(null===l||null===a||null===h)return;const n=d.getBoundingClientRect();a=h,h=i(we(e,n)),t(l,h,a)}),d.addEventListener("mouseup",e=>{s(e,"end")&&null!==l&&null!==a&&null!==h&&(r(l,h,a),l=null,h=null)})},Ae=(e,t,n,r,s)=>{const d=o("#rects");let l=null,a=null;Ie(e,(e,t)=>{null!==a&&(l=Te(e,t),i(a,l))},{onStart:()=>{a=r(),l={x:0,y:0,width:0,height:0},d.append(a)},onEnd:()=>{null!==a&&null!==l&&(a.remove(),l.width>=1&&l.height>=1&&s(l),a=null,l=null)},transformPoint:n,predicate:t})},Te=(e,t)=>{const n=(({x1:e,y1:t,x2:n,y2:r})=>{const i=Math.min(e,n),o=Math.max(e,n);return{x1:i,y1:Math.min(t,r),x2:o,y2:Math.max(t,r)}})(xe(e,t)),{x1:r,y1:i}=n;return{x:r,y:i,width:n.x2-n.x1,height:n.y2-n.y1}},Pe=(e,t)=>{const n=Ce(e);Ae(e,(t,n)=>"draw"===e.mode()&&("start"!==n||0===t.button),n,()=>u({stroke:"#222",fill:"none"}),e=>{const n=z(16,R).join(""),r=Object.assign({id:n},e);t.rects.add([r]),t.selection.set([n])})},je=(e,t)=>{const n=o("#rects"),r=Se(e),i=Ne(t,r);Ae(e,(t,n)=>{if("select"!==e.mode())return!1;if("start"===n){if(0!==t.button)return!1;if("move"===i(t))return!1}return!0},r,()=>u({stroke:"#39f",fill:"none"}),r=>{const i=[...n.querySelectorAll("rect")],o=[];i.forEach(e=>{void 0!==((e,t)=>{const n=Math.max(e.x,t.x),r=Math.max(e.y,t.y),i=Math.min(e.x+e.width,t.x+t.width),o=Math.min(e.y+e.height,t.y+t.height);if(i>=n&&o>=r){return{x:n,y:r,width:i-n,height:o-r}}})(s(e),r)&&o.push(e.id)}),e.keys.shift?t.selection.toggle(o):t.selection.set(o)})},Me=e=>{const t=o("#viewport");document.body.addEventListener("resize",()=>{const{width:n,height:r}=t.getBoundingClientRect();e.viewSize({width:n,height:r})}),document.body.dispatchEvent(new Event("resize"))},ke=e=>{o("#reset-zoom").addEventListener("click",t=>{t.preventDefault(),e.zoomToFit()})},Re=e=>{o("#undo").addEventListener("click",t=>{t.preventDefault(),e.rects.undo()})},Le=e=>{o("#redo").addEventListener("click",t=>{t.preventDefault(),e.rects.redo()})},ze=(e,t)=>{const n=o("#viewport");n.addEventListener("wheel",r=>{r.preventDefault();const{left:i,top:o}=n.getBoundingClientRect(),{deltaY:s,clientX:d,clientY:l}=r,{scale:a}=e.viewTransform(),h=d-i,c=l-o,u=a+-.1*s;t.zoomAt({x:h,y:c,scale:u})})},De=e=>{document.addEventListener("keydown",t=>{e.keys[t.key]=!0}),document.addEventListener("keyup",t=>{e.keys[t.key]=!1})},Ve=()=>{const e=o("#tools"),t=((e,t)=>{const n=e.elements.namedItem(t);if(n instanceof RadioNodeList)return n;throw Error("Expected a RadioNodeList called "+t)})(o("form",e),"mode");return e=>(void 0!==e&&(t.value=e),t.value)},Be=()=>{const e=o("#snap-width"),t=o("#snap-height");return n=>{if(void 0!==n){const{width:r,height:i}=n;e.valueAsNumber=r,t.valueAsNumber=i}return{width:e.valueAsNumber,height:t.valueAsNumber}}},Fe=()=>{const e=o("#document");let t={width:0,height:0};return n=>{if(void 0!==n){t=n;const{width:r,height:o}=t;i(e,{viewBox:`0 0 ${r} ${o}`})}const{width:r,height:o}=t;return{width:r,height:o}}},Ge=()=>{const e=o("#grid");let t={width:0,height:0};return n=>{if(void 0!==n){t=n;const{width:r,height:o}=t;i(e,{x:0,y:0,width:r,height:o})}const{width:r,height:o}=t;return{width:r,height:o}}},Ue=()=>{let e={x:0,y:0,scale:1};return t=>{if(void 0!==t){e=t;const{x:n,y:r,scale:s}=e,d=Math.max(s,.1),l=o("#body");i(l,{transform:`translate(${n} ${r}) scale(${d})`})}const{x:n,y:r,scale:s}=e;return{x:n,y:r,scale:s}}},qe=le({id:"app"},me("Rect Editor"),ge(ve({id:"tools"}),ve({id:"viewport"})),ye("© 2020 Nik Coughlin")),We=fe(pe({id:"undo",type:"button"},"Undo"),pe({id:"redo",type:"button"},"Redo"),pe({id:"reset-zoom",type:"button"},"Reset Zoom"),ae(he("Pointer Mode"),...e.map(e=>ce(ue({type:"radio",name:"mode",value:e}),e))),ae(he("Snap to Grid"),ce("Width",ue({id:"snap-width",type:"number",min:1,step:1})),ce("Height",ue({id:"snap-height",type:"number",min:1,step:1})))),$e=h({id:"document"},p(),c({id:"body"},u({id:"grid",fill:"#ddd"}),c({id:"rects"}))),Xe=o("#tools",qe),Ye=o("#viewport",qe);Xe.append(We),Ye.append($e),document.body.append(qe);const Je={mode:Ve(),snap:Be(),viewSize:Fe(),viewTransform:Ue(),documentSize:Ge(),keys:{}};Je.mode("pan"),Je.snap({width:2,height:2}),Je.documentSize({width:1e3,height:1e3});const He=(e=>{const t=ie(e),n=oe(e),r=(()=>{const{root:e,elMap:t,commands:n,events:r,on:i,tasks:o,orderActions:s,reorder:d}=W();return{add:e=>{e.forEach(o.addOne),n.add({type:"add",elements:e}),r.add.emit(e)},remove:t=>{const i=e.childNodes.map(e=>e.value.id),s=t.map(o.removeOne);n.add({type:"remove",before:i,elements:s}),r.remove.emit(t)},update:e=>{const t=e.map(o.updateOne);n.add({type:"update",elements:t}),r.update.emit(e)},toStart:d(s.toStart),toEnd:d(s.toEnd),forward:d(s.forward),back:d(s.back),has:e=>t.has(e),get:e=>D(t,e).value,toArray:()=>e.childNodes.map(e=>e.value),undo:()=>{const e=n.nextUndo();return void 0!==e&&((({addOne:e,removeOne:t,updateOne:n,setOrder:r},i,o)=>{if("add"===o.type){const e=o.elements.map(e=>e.id);e.forEach(t),i.remove.emit(e)}if("remove"===o.type&&(o.elements.forEach(e),r(o.before),i.add.emit(o.elements),i.setOrder.emit(o.before)),"update"===o.type){const e=o.elements.map(e=>e.prev);e.forEach(n),i.update.emit(e)}"order"===o.type&&(r(o.before),i.setOrder.emit(o.before))})(o,r,e),r.undo.emit(),!0)},redo:()=>{const e=n.nextRedo();return void 0!==e&&((({addOne:e,removeOne:t,updateOne:n,setOrder:r},i,o)=>{if("add"===o.type&&(o.elements.forEach(e),i.add.emit(o.elements)),"remove"===o.type){const e=o.elements.map(e=>e.id);e.forEach(t),i.remove.emit(e)}if("update"===o.type){const e=o.elements.map(e=>e.value);e.forEach(n),i.update.emit(e)}"order"===o.type&&(r(o.after),i.setOrder.emit(o.after))})(o,r,e),r.redo.emit(),!0)},on:i}})(),s=ne(),{actions:d}=s,l=se();s.on(l);const a={zoomToFit:t,zoomAt:n,rects:r,selection:d};return((e,t)=>{const n=o("#rects");e.on.add(e=>{n.append(...e.map(re))}),e.on.remove(e=>e.forEach(e=>{o("#"+e).remove()})),e.on.update(e=>e.forEach(e=>{const t=o("#"+e.id);i(t,e)})),e.on.setOrder(e=>e.forEach(e=>{const t=o("#"+e);n.append(t)})),e.on.undo(()=>t.selection.clear()),e.on.redo(()=>t.selection.clear())})(r,a),a})(Je);((e,n)=>{De(e),Me(e),ke(n),ze(e,n),(e=>{let t=!1;Ie(e,(t,n)=>{const r=e.viewTransform(),{x:i,y:o}=be(xe(t,n));r.x+=i,r.y+=o,e.viewTransform(r)},{predicate:(n,r)=>"start"===r&&1===n.button?(t=!0,!0):("end"===r&&(t=!1),!!t||"pan"===e.mode()&&("start"!==r||0===n.button))})})(e),((e,n)=>{_e(Se(e),(r,i)=>{if("select"!==e.mode())return;if(0!==r)return;const o=Oe().filter(e=>{const n=Ee(e);return t(n,i)});if(0===o.length)return void n.selection.clear();const s=o[o.length-1],{id:d}=s;e.keys.Shift?n.selection.toggle([d]):n.selection.set([d])})})(e,n),je(e,n),((e,t)=>{const n=Se(e),r=Ne(t,n);Ie(e,(e,n,r)=>{const d=n.x-r.x,l=n.y-r.y;if(0===d&&0===l)return;const a=t.selection.get();a.map(e=>o("#"+e)).forEach(e=>{let{x:t,y:n}=s(e);t+=d,n+=l,i(e,{x:t,y:n})}),t.selection.set(a)},{predicate:(t,n)=>{if("select"!==e.mode())return!1;if("start"===n){if(0!==t.button)return!1;if("move"!==r(t))return!1}return!0},onEnd:()=>{const e=t.selection.get(),n=e.map(e=>o("#"+e)).map(e=>{const{id:t}=e,n=s(e);return Object.assign({id:t},n)});t.rects.update(n),t.selection.set(e)}})})(e,n),(e=>{_e(Se(e),(n,r)=>{if("draw"!==e.mode())return;if(0!==n)return;Oe().some(e=>{const n=Ee(e);return t(n,r)})&&e.mode("select")})})(e),Pe(e,n),Re(n),Le(n)})(Je,He),He.zoomToFit();const Ze=JSON.stringify(Je,(e,t)=>"function"==typeof t?t():t,2);console.log(Ze)}();
